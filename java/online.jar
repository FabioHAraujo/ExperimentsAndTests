import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import org.bukkit.Bukkit;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerQuitEvent;
import org.bukkit.plugin.java.JavaPlugin;

public class PlayerTracker extends JavaPlugin implements Listener {

  // Substitua os valores abaixo pelas informações do seu banco de dados MySQL
  private static final String DB_HOST = "localhost";
  private static final String DB_NAME = "minecraft";
  private static final String DB_USER = "minecraft";
  private static final String DB_PASS = "password";

  private Connection connection;

  @Override
  public void onEnable() {
    try {
      connection = DriverManager.getConnection("jdbc:mysql://" + DB_HOST + "/" + DB_NAME, DB_USER, DB_PASS);
      Bukkit.getPluginManager().registerEvents(this, this);
    } catch (SQLException e) {
      e.printStackTrace();
    }
  }

  @EventHandler
  public void onJoin(PlayerJoinEvent event) {
    updatePlayerCount(1);
  }

  @EventHandler
  public void onQuit(PlayerQuitEvent event) {
    updatePlayerCount(-1);
  }

  private void updatePlayerCount(int delta) {
    try {
      PreparedStatement statement = connection.prepareStatement("UPDATE player_count SET count = count + ? WHERE id = 1");
      statement.setInt(1, delta);
      statement.executeUpdate();
      statement.close();
    } catch (SQLException e) {
      e.printStackTrace();
    }
  }
}
